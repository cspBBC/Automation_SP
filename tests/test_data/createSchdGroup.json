{
  "usp_CreateUpdateSchedulingTeam": [
    {
      "case_id": "POSITIVE_CHAIN_CREATE_UPDATE_VALIDATE",
      "case_type": "POSITIVE",
      "description": "3-step chain: Create team, update allocations, update miscellaneous",
      "post_sql": [
        "select * from schedulingteams where schedulingteamid = {created_team_id}",
        "select * from history where userid = {intuserid} and attributeid = {created_team_id} order by historyid desc",
        "select * from SchedulingGroupsTeamsLinks where schedulingteamid = {created_team_id}"
      ],
      "expected_post_state": [
        {"row_count": 1, "expected_columns": {"schedulingTeamName": "{generated_team_name}", "schedulingTeamDescription": "Testing_POC", "isActive": 1}},
        {"row_count":3},
        {"row_count": 1}
      ],
      "chain_config": [
        {
          "step": 1,
          "sp_name": "usp_CreateUpdateSchedulingTeam",
          "parameters": {
            "@schedulingTeamName": "{generated_team_name}",
            "@schedulingTeamDescription": "Testing_POC",
            "@divisionId": 6,
            "@isActive": 1,
            "@defaultSicknessHoursAllocation": 1,
            "@defaultDutyDuration": 28800,
            "@workTimeDirectiveOptOut": 0,
            "@checkOverSixDaysWorked": 1,
            "@checkOverFiveDaysWorked": 0,
            "@signIn": 0,
            "@signInDays": 0,
            "@allowInBuilding": 0,
            "@allowOvertimeRequests": 0,
            "@colourWeek": 0,
            "@locks": 0,
            "@locksStart": 0,
            "@locksEnd": 0,
            "@locksWeekataTime": 0,
            "@maskType": "2",
            "@maskAfter": 2,
            "@DailyViewMasking": 0,
            "@dailyViewMaskingDays": 0,
            "@freelancerMasking": 0,
            "@freelancerMaskingDays": 0,
            "@restrictedEditing": 0,
            "@numberofDaysAllowedEditing": 0,
            "@editingStart": 0,
            "@editingEnd": 0,
            "@WeekendOnly": 0,
            "@autoLockTodayTimer": 0,
            "@hasGridChecks": 0,
            "@showProductionView": 1,
            "@autoImportWeeks": 0,
            "@NoofAutoAutoimportWeeks": "",
            "@hasXmasPoints": 1,
            "@defaultNumberweeksRotaPattern": 1,
            "@defaultRotaStartDate": "Dec 30 1995 12:00AM",
            "@currentLeaveYear": 2026,
            "@leaveSelectiveHide": 0,
            "@hasHandovers": 1,
            "@staffAvailabilityReportStartDate": "Feb 21 2026 12:00AM",
            "@task": "create",
            "@tab": "identity",
            "@intuserid": 10201,
            "@intnewteamid": 0,
            "@email": "ankur.jain.ext@bbc.co.uk",
            "@defaultActiveCode": 0,
            "@IsRestrictCopyDuty": 1,
            "@showJobsInWeeklyView": 1,
            "@IsCreateDutyFromRota": 1,
            "@IsShowEditYearly": 1,
            "@IsRestrictDeleteDuty": 0,
            "@RestrictApplyROTAPattern": 0
          },
          "output_mapping": {
            "@intnewteamid": "created_team_id"
          }
        },
        {
          "step": 2,
          "sp_name": "usp_CreateUpdateSchedulingTeam",
          "parameters": {
            "@schedulingTeamName": "{generated_team_name}",
            "@schedulingTeamDescription": "Testing_POC",
            "@divisionId": 6,
            "@isActive": 1,
            "@defaultSicknessHoursAllocation": 2,
            "@defaultDutyDuration": 28800,
            "@workTimeDirectiveOptOut": 0,
            "@checkOverSixDaysWorked": 1,
            "@checkOverFiveDaysWorked": 0,
            "@signIn": 0,
            "@signInDays": 0,
            "@allowInBuilding": 0,
            "@allowOvertimeRequests": 0,
            "@colourWeek": 0,
            "@locks": 0,
            "@locksStart": 0,
            "@locksEnd": 0,
            "@locksWeekataTime": 0,
            "@maskType": "2",
            "@maskAfter": 2,
            "@DailyViewMasking": 0,
            "@dailyViewMaskingDays": 0,
            "@freelancerMasking": 0,
            "@freelancerMaskingDays": 0,
            "@restrictedEditing": 0,
            "@numberofDaysAllowedEditing": 0,
            "@editingStart": 0,
            "@editingEnd": 0,
            "@WeekendOnly": 0,
            "@autoLockTodayTimer": 0,
            "@hasGridChecks": 0,
            "@showProductionView": 1,
            "@autoImportWeeks": 0,
            "@NoofAutoAutoimportWeeks": "",
            "@hasXmasPoints": 1,
            "@defaultNumberweeksRotaPattern": 1,
            "@defaultRotaStartDate": "Dec 30 1995 12:00AM",
            "@currentLeaveYear": 2026,
            "@leaveSelectiveHide": 0,
            "@hasHandovers": 1,
            "@staffAvailabilityReportStartDate": "Feb 21 2026 12:00AM",
            "@task": "update",
            "@tab": "allocations",
            "@intuserid": 10201,
            "@intnewteamid": 0,
            "@email": "ankur.jain.ext@bbc.co.uk",
            "@defaultActiveCode": 0,
            "@IsRestrictCopyDuty": 1,
            "@showJobsInWeeklyView": 1,
            "@IsCreateDutyFromRota": 1,
            "@IsShowEditYearly": 1,
            "@IsRestrictDeleteDuty": 0,
            "@RestrictApplyROTAPattern": 0
          },
          "input_mapping": {
            "@intnewteamid": "created_team_id"
          },
          "output_mapping": {
            "@intnewteamid": "created_team_id"
          }
        },
        {
          "step": 3,
          "sp_name": "usp_CreateUpdateSchedulingTeam",
          "parameters": {
            "@schedulingTeamName": "{generated_team_name}",
            "@schedulingTeamDescription": "Testing_POC",
            "@divisionId": 6,
            "@isActive": 1,
            "@defaultSicknessHoursAllocation": 1,
            "@defaultDutyDuration": 28800,
            "@workTimeDirectiveOptOut": 0,
            "@checkOverSixDaysWorked": 1,
            "@checkOverFiveDaysWorked": 0,
            "@signIn": 0,
            "@signInDays": 0,
            "@allowInBuilding": 0,
            "@allowOvertimeRequests": 0,
            "@colourWeek": 0,
            "@locks": 0,
            "@locksStart": 0,
            "@locksEnd": 0,
            "@locksWeekataTime": 0,
            "@maskType": "2",
            "@maskAfter": 2,
            "@DailyViewMasking": 0,
            "@dailyViewMaskingDays": 0,
            "@freelancerMasking": 0,
            "@freelancerMaskingDays": 0,
            "@restrictedEditing": 0,
            "@numberofDaysAllowedEditing": 0,
            "@editingStart": 0,
            "@editingEnd": 0,
            "@WeekendOnly": 0,
            "@autoLockTodayTimer": 0,
            "@hasGridChecks": 0,
            "@showProductionView": 0,
            "@autoImportWeeks": 0,
            "@NoofAutoAutoimportWeeks": "",
            "@hasXmasPoints": 0,
            "@defaultNumberweeksRotaPattern": 1,
            "@defaultRotaStartDate": "Dec 30 1995 12:00AM",
            "@currentLeaveYear": 2026,
            "@leaveSelectiveHide": 0,
            "@hasHandovers": 1,
            "@staffAvailabilityReportStartDate": "Feb 21 2026 12:00AM",
            "@task": "update",
            "@tab": "miscellaneous",
            "@intuserid": 10201,
            "@intnewteamid": 0,
            "@email": "ankur.jain.ext@bbc.co.uk",
            "@defaultActiveCode": 0,
            "@IsRestrictCopyDuty": 1,
            "@showJobsInWeeklyView": 1,
            "@IsCreateDutyFromRota": 1,
            "@IsShowEditYearly": 1,
            "@IsRestrictDeleteDuty": 0,
            "@RestrictApplyROTAPattern": 0
          },
          "input_mapping": {
            "@intnewteamid": "created_team_id"
          },
          "output_mapping": {
            "@intnewteamid": "created_team_id"
          }
        }
      ],
      "cleanup_sql": [
        "DELETE FROM SchedulingGroupsTeamsLinks WHERE schedulingteamid = {created_team_id}",
        "DELETE FROM Exported_rota WHERE schedulingteamid = {created_team_id}",
        "DELETE FROM MasterRotas WHERE teamid = {created_team_id}",
        "DELETE FROM SchedulingTeams WHERE schedulingteamid = {created_team_id}"
      ]
    }
  ]
}